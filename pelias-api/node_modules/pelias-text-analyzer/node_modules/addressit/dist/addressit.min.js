!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.addressit=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";var reNumeric=/^\d+$/;function Address(text,opts){if(!(this instanceof Address)){return new Address(text)}this.text=text;this.parts=[]}module.exports=Address;var proto=Address.prototype;proto._extractStreetParts=function(startIndex){var index=startIndex;var streetParts=[];var numberParts;var parts=this.parts;var testFn=function(){return true};while(index>=0&&testFn()){var alphaPart=isNaN(parseInt(parts[index],10));if(streetParts.length<2||alphaPart){streetParts.unshift(parts.splice(index--,1))}else{if(!numberParts){numberParts=[]}numberParts.unshift(parts.splice(index--,1));testFn=function(){var isAlpha=isNaN(parseInt(parts[index],10));return numberParts?!isAlpha:isAlpha}}}this.number=numberParts?numberParts.join("/"):"";this.street=streetParts.join(" ").replace(/\,/g,"");this.number=reNumeric.test(this.number)?parseInt(this.number,10):this.number};proto.clean=function(cleaners){cleaners=cleaners||[];for(var ii=0;ii<cleaners.length;ii++){if(typeof cleaners[ii]=="function"){this.text=cleaners[ii].call(null,this.text)}else if(cleaners[ii]instanceof RegExp){this.text=this.text.replace(cleaners[ii],"")}}return this};proto.extract=function(fieldName,regexes){var match;var rgxIdx;var ii;var value;var lookups=[];if(typeof regexes=="object"&&typeof regexes.splice=="undefined"){var newRegexes=[];for(var key in regexes){newRegexes[newRegexes.length]=regexes[key];lookups[newRegexes.length-1]=key}regexes=newRegexes}for(rgxIdx=0;rgxIdx<regexes.length;rgxIdx++){for(ii=this.parts.length;ii--;){match=regexes[rgxIdx].exec(this.parts[ii]);if(match){if(match[2]){this.parts.splice(ii,1,match[2])}else{this.parts.splice(ii,1)}value=lookups[rgxIdx]||match[1]}}}this[fieldName]=parseInt(value,10)||value;return this};proto.extractStreet=function(regexes,reSplitStreet){var reNumericesque=/^(\d*|\d*\w)$/;var parts=this.parts;regexes=regexes||[];function locateBestStreetPart(startIndex){var bestIndex=startIndex;for(var ii=startIndex-1;ii>=0;ii--){for(var rgxIdx=0;rgxIdx<regexes.length;rgxIdx++){if(regexes[rgxIdx].test(parts[ii])&&parts[ii-1]&&!reNumericesque.test(parts[ii-1])){bestIndex=ii;break}}}return bestIndex}for(var partIdx=parts.length;partIdx--;){for(var rgxIdx=0;rgxIdx<regexes.length;rgxIdx++){if(regexes[rgxIdx].test(parts[partIdx])&&partIdx>0){var startIndex=locateBestStreetPart(partIdx);if(reSplitStreet.test(parts[startIndex+1])){startIndex+=1}this._extractStreetParts(startIndex);break}}}return this};proto.finalize=function(){this.regions=this.parts.join(" ").split(/\,\s?/);this.parts=[];return this};proto.split=function(separator){var newParts=this.text.split(separator||" ");this.parts=[];for(var ii=0;ii<newParts.length;ii++){if(newParts[ii]){this.parts[this.parts.length]=newParts[ii]}}return this};proto.toString=function(){var output="";if(this.building){output+=this.building+"\n"}if(this.street){output+=this.number?this.number+" ":"";output+=this.street+"\n"}output+=this.regions.join(", ")+"\n";return output}},{}],2:[function(_dereq_,module,exports){"use strict";module.exports=function(input,opts){var parser=(opts||{}).parser||_dereq_("./parsers/en");return parser(input,opts)}},{"./parsers/en":4}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(textRegexes){var regexes=[];var reStreetCleaner=/^\^?(.*)\,?\$?$/;var ii;for(ii=textRegexes.length;ii--;){regexes[ii]=new RegExp(textRegexes[ii].replace(reStreetCleaner,"^$1,?$"),"i")}return regexes}},{}],4:[function(_dereq_,module,exports){"use strict";var Address=_dereq_("../address");var compiler=_dereq_("./compiler");var streetRegexes=compiler(["ALLE?Y","APP(ROACH)?","ARC(ADE)?","AV(E|ENUE)?","(BOULEVARD|BLVD)","BROW","BYPA(SS)?","C(AUSE)?WAY","(CIRCUIT|CCT)","CIRC(US)?","CL(OSE)?","CO?PSE","(CORNER|CNR)","C(OUR)?T","CRES(CENT)?","DR(IVE)?","ESP(LANANDE)?","F(REE)?WAY","(FRONTAGE|FRNT)","(GLADE|GLD)","GR(EE)?N","(HIGHWAY|HWY)","(LANE|LN)","LINK","LOOP","MALL","MEWS","(PACKET|PCKT)","P(ARA)?DE","(PARKWAY|PKWY)","PL(ACE)?","PROM(ENADE)?","RES(ERVE)?","RISE","R(OA)?D","ROW","SQ(UARE)?","ST(REET)?","STRI?P","TARN","T(ERRA)?CE","(THOROUGHFARE|TFRE)","TRACK?","T(RUNK)?WAY","VI?STA","WALK","WA?Y","W(ALK)?WAY","YARD"]);var reSplitStreet=/^(N|NTH|NORTH|E|EST|EAST|S|STH|SOUTH|W|WST|WEST)\,$/i;module.exports=function(text,opts){return new Address(text,opts).clean([function(input){return input.replace(/(\w{2})\./g,"$1")},function(input){return input.replace(/^\s*SHOP\s?(\d*)\,?\s*/i,"$1/")}]).split(/\s/).extract("unit",[/^(?:\#|APT|APARTMENT)\s?(\d+)/,/^(\d+)\/(.*)/]).extract("country",{AU:/^AUSTRAL/,US:/(^UNITED\sSTATES|^U\.?S\.?A?$)/}).extractStreet(streetRegexes,reSplitStreet).finalize()}},{"../address":1,"./compiler":3}]},{},[2])(2)});